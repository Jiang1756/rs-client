根据对 RustDesk 免密连接功能的深度排查，目前该功能的实现处于“代码已就绪但闭环未完成”的状态。以下是排查出的待办事项清单：

🛠️ RustDesk 免密连接功能：排查报告与待办清单
1. 核心问题扫描
虽然 rustdesk-api-server 和 rs-client 的源码中已经实现了 Ticket 验证逻辑，但由于以下关键环节点失效，导致实际连接仍然触发鉴权失败。

❌ 关键失效点 1：公钥动态同步缺失
现象：被控端（Client）在验证票据时，找不到验签所需的 ticket-public-key。
代码证据：rs-client 中的 
validate_password
 函数尝试通过 
get_builtin_option("ticket-public-key")
 获取公钥，但目前配置中该值为空。
后果：被控端收到票据后无法验证其真伪，直接退回密码校验模式。
❌ 关键失效点 2：公钥不具备持久性
现象：rustdesk-api-server 每次重新启动都会生成一组全新的 Ed25519 密钥对。
位置：
service/ticket.go
 中的 
Init()
 方法。
后果：即使在客户端写死了公钥，只要服务端一重启，所有之前签发的票据和客户端内置的密钥将全部作废。
❌ 关键失效点 3：主控端自动获取 Ticket 逻辑未闭环
现象：主控端在发起连接前，未能在某些场景下自动调用 /api/ticket 获取票据并填充到 
password
 字段中。
2. 还没完成的任务清单 (TODO List)
A. API Server (Go 侧)
[ ] 密钥持久化改造：
修改 
service/ticket.go
，不再每次 
Init
 都生成新密钥。
改为从 conf/config.yaml 或数据库读取 private_key；如果不存在再生成并持久化存储。
[ ] 增加公钥分发机制：
在 LoginResponse 或 
Config
 同步接口中，增加 ticket-public-key 的下发。
B. Client (Rust/Flutter 侧)
[ ] 强制注入 Builtin Option：
在编译 rs-client 时，通过环境变量或配置文件将当前 API Server 的公钥强制注入到 Builtin Settings。
[ ] 完善 Flutter 端连接拦截器：
检查 flutter/lib/common.dart，确保点击“连接”按钮时，如果发现对方支持免密（可通过版本号或自定义标识判定），先去 API 请求 Ticket。
C. 运维与配置
[ ] 被控端配置更新：
需要向被控端的 id_ed25519.pub 同级目录下手动或自动下发 ticket-public-key 相关的配置文件。
3. 建议修复步骤 (参考顺序)
先固定私钥：手动在 rustdesk-api-server 的 
data
 目录生成一个固定的密钥文件，防止重启失效。
手动验证闭环：通过 curl 从 API 获取一个 Ticket，然后手动修改客户端代码将该 Ticket 作为固定密码，观察被控端是否能通过离线验签。
自动化分发：实现公钥随登录过程自动下发至客户端内存。
